CKEDITOR.plugins.add('esp_video',{lang:['en','ru','uk'],init:function(c){var d=c.lang.esp_video;if(typeof c.element.data=='undefined'){alert('The "video" plugin requires CKEditor 3.5 or newer');return}CKEDITOR.dialog.add('esp_video',this.path+'dialogs/esp_video.js');c.addCommand('esp_video',new CKEDITOR.dialogCommand('esp_video'));c.ui.addButton('Esp_video',{label:d.toolbar,command:'esp_video',icon:this.path+'images/esp_video.png'});c.addCss('img.cke_video'+'{'+'background-image: url('+CKEDITOR.getUrl(this.path+'images/placeholder.png')+');'+'background-position: center center;'+'background-repeat: no-repeat;'+'background-color:gray;'+'border: 1px solid #a9a9a9;'+'width: 80px;'+'height: 80px;'+'}');if(c.addMenuItems){c.addMenuItems({video:{label:d.properties,command:'video',group:'flash'}})}c.on('doubleclick',function(a){var b=a.data.element;if(b.is('img')&&b.data('cke-real-element-type')=='video')a.data.dialog='video'});if(c.contextMenu){c.contextMenu.addListener(function(a,b){if(a&&a.is('img')&&!a.isReadOnly()&&a.data('cke-real-element-type')=='video')return{video:CKEDITOR.TRISTATE_OFF}})}CKEDITOR.dtd.$empty['cke:source']=1;CKEDITOR.dtd.$empty['source']=1;c.lang.fakeobjects.video=d.fakeObject},afterInit:function(d){var e=d.dataProcessor,htmlFilter=e&&e.htmlFilter,dataFilter=e&&e.dataFilter;var f=d.plugins.googleMapsHandler;dataFilter.addRules({elements:{$:function(a){if(a.name=='video'){a.name='cke:video';var b=d.createFakeParserElement(a,'cke_video','video',false),fakeStyle=b.attributes.style||'';var c=a.attributes.width,height=a.attributes.height,poster=a.attributes.poster;if(typeof c!='undefined')fakeStyle=b.attributes.style=fakeStyle+'width:'+CKEDITOR.tools.cssLength(c)+';';if(typeof height!='undefined')fakeStyle=b.attributes.style=fakeStyle+'height:'+CKEDITOR.tools.cssLength(height)+';';if(poster)fakeStyle=b.attributes.style=fakeStyle+'background-image:url('+poster+');';return b}}}});htmlFilter.addRules({elements:{$:function(a){if(a.name=='img'){var b=a.attributes.mapnumber;if(b){var c,f=d.plugins.googleMapsHandler,oMap=f.getMap(b);if(oMap&&oMap.generatedType>1){f.CreatedMapsNames.push(oMap.number);c=new CKEDITOR.htmlParser.cdata(oMap.BuildScript());a.parent.children.push(c)}delete a.attributes.mapnumber}}return a}}})}});

